# 编辑报表页面需求文档

## 一、页面结构与功能

编辑报表页面整体分为以下区域：
1. 顶部标题区：显示报表名称、描述，并支持编辑。
2. Tabs区：
   - 支持新增、删除、重命名Tab。
   - 每个Tab下可单独配置内容。
3. Tab内容区：
   - Filter区：
     - 支持动态添加、删除、编辑筛选项（Filter）。
     - 每个筛选项布局为上下两行，上行为label，下行为组件。
     - 支持的筛选类型：
       - `singleSelect`：单选下拉框
       - `multiSelect`：多选下拉框
       - `text`：文本输入框
       - `date`：日期区间选择（Date Range组件）
     - Apply按钮始终固定在Filter区右下角。
   - Chart区：
     - 支持通过"添加图表"按钮，将可用的metric添加到当前Tab的chart区。
     - 支持删除、重命名chart。
     - Chart区域使用`react-grid-layout`实现拖拽和缩放，用户可自由调整每个chart的位置和大小。
     - 每个chart可配置其绑定的metric。
     - chart区域分为上下两个部分，上部分显示chart的title，下部分显示图表。

## 二、交互与数据流

1. 页面加载时，根据路由参数中的dashboard id，调用服务端API获取报表详情。
2. 用户可：
   - 新增/删除/重命名Tab。
   - 在Tab下添加/删除/编辑Filter。
   - 在Tab下通过"添加图表"选择metric，添加为chart。
   - 拖拽、缩放chart，调整其在布局中的位置和大小（基于react-grid-layout）。
   - 编辑chart的标题、绑定的metric。
3. 所有编辑操作均实时更新本地state，支持"保存"操作将变更提交到服务端。
4. 支持"预览"模式，切换到只读视图查看当前报表效果。
5. 支持接口请求失败、加载中、无数据等状态处理。

## 三、技术要求

1. 前端使用React，chart区布局采用`react-grid-layout`。
2. Filter区组件请勿使用Form表单实现，需手动管理各筛选项的state。
3. Apply按钮始终位于Filter区右下角。
4. Chart区所有图表均可拖拽、缩放，布局信息（x, y, w, h）需持久化。
5. 支持metric、tab、filter的动态增删改。
6. 代码需保证良好的可维护性和可扩展性。
7. 需处理接口请求失败、加载中、无数据等状态。
8. 支持"保存"与"预览"两种模式切换。

## 四、示意交互流程

1. 用户点击"新增Tab"按钮，输入Tab名称，Tab被添加到Tabs区。
2. 用户在Tab下点击"添加筛选项"，选择类型并填写label，筛选项出现在Filter区。
3. 用户点击"添加图表"，弹出metric选择框，选择后图表出现在Chart区。
4. 用户拖拽/缩放chart，调整布局。
5. 用户可编辑chart标题、删除chart。
6. 用户点击"保存"按钮，所有变更通过API提交到服务端。
7. 用户点击"预览"按钮，切换到只读视图。
